{% extends "base.html" %}

{% block title %}Home - Gerador de Landing Page{% endblock %}

{% block content %}
<div x-data="indexPage()" class="space-y-6">
    <!-- Header Section -->
    <div class="bg-white rounded-lg shadow-sm border p-6">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900 flex items-center">
                    <svg class="w-8 h-8 text-primary-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    Gerador de Landing Pages
                </h1>
                <p class="text-gray-600 mt-1">Crie p√°ginas profissionais com intelig√™ncia artificial</p>
            </div>
            <button @click="$dispatch('show-create-modal')" 
                    class="bg-primary-600 hover:bg-primary-700 text-white px-6 py-3 rounded-lg font-medium flex items-center space-x-2 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                <span>Nova Landing Page</span>
            </button>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Form Section -->
        <div class="lg:col-span-2">
            <div class="bg-white rounded-lg shadow-sm border">
                <div class="bg-gradient-to-r from-primary-600 to-primary-700 text-white p-6 rounded-t-lg">
                    <h2 class="text-xl font-semibold flex items-center">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Nova Landing Page
                    </h2>
                    <p class="text-primary-100 mt-1">Preencha os dados abaixo para criar sua p√°gina</p>
                </div>
                
                <form method="POST" action="/create-request" enctype="multipart/form-data" 
                      @submit="handleSubmit" class="p-6 space-y-6">
                    
                    <!-- Basic Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                                </svg>
                                T√≠tulo da P√°gina *
                            </label>
                            <input type="text" 
                                   name="page_title" 
                                   x-model="form.pageTitle"
                                   required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
                                   placeholder="Ex: Site da Empresa XYZ">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                </svg>
                                Nome da Empresa *
                            </label>
                            <input type="text" 
                                   name="company_name" 
                                   x-model="form.companyName"
                                   required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
                                   placeholder="Ex: Kaptha Tech">
                        </div>
                    </div>
                    
                    <!-- File Uploads -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Logo Upload -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6 6h.01M6 20h36a2 2 0 012 2v16a2 2 0 01-2 2H6a2 2 0 01-2-2V22a2 2 0 012-2z"></path>
                                </svg>
                                Logo da Empresa
                            </label>
                            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-primary-400 transition-colors cursor-pointer"
                                 @click="$refs.logoInput.click()"
                                 @dragover.prevent
                                 @drop.prevent="handleLogoDrop($event)">
                                <div class="space-y-1 text-center">
                                    <template x-if="!logoPreview">
                                        <div>
                                            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                            </svg>
                                            <div class="flex text-sm text-gray-600">
                                                <span class="font-medium text-primary-600 hover:text-primary-500">Upload logo</span>
                                                <p class="pl-1">ou arraste aqui</p>
                                            </div>
                                            <p class="text-xs text-gray-500">PNG, JPG, SVG at√© 5MB</p>
                                        </div>
                                    </template>
                                    
                                    <template x-if="logoPreview">
                                        <div class="relative">
                                            <img :src="logoPreview" class="mx-auto h-20 w-20 object-cover rounded-lg">
                                            <button type="button" 
                                                    @click.stop="removeLogo()"
                                                    class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600">
                                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                </svg>
                                            </button>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <input x-ref="logoInput" 
                                   name="company_logo" 
                                   type="file" 
                                   accept="image/*" 
                                   @change="handleLogoChange($event)"
                                   class="hidden">
                        </div>
                        
                        <!-- Images Upload -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6 6h.01M6 20h36a2 2 0 012 2v16a2 2 0 01-2 2H6a2 2 0 01-2-2V22a2 2 0 012-2z"></path>
                                </svg>
                                Imagens para o Site
                            </label>
                            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-primary-400 transition-colors cursor-pointer"
                                 @click="$refs.imagesInput.click()"
                                 @dragover.prevent
                                 @drop.prevent="handleImagesDrop($event)">
                                <div class="space-y-1 text-center">
                                    <template x-if="imagesPreviews.length === 0">
                                        <div>
                                            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                                <path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6 6h.01M6 20h36a2 2 0 012 2v16a2 2 0 01-2 2H6a2 2 0 01-2-2V22a2 2 0 012-2z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                            </svg>
                                            <div class="flex text-sm text-gray-600">
                                                <span class="font-medium text-primary-600 hover:text-primary-500">Upload imagens</span>
                                                <p class="pl-1">ou arraste aqui</p>
                                            </div>
                                            <p class="text-xs text-gray-500">M√∫ltiplas imagens at√© 10MB cada</p>
                                        </div>
                                    </template>
                                    
                                    <template x-if="imagesPreviews.length > 0">
                                        <div>
                                            <div class="grid grid-cols-3 gap-2 mb-2">
                                                <template x-for="(preview, index) in imagesPreviews.slice(0, 6)" :key="index">
                                                    <div class="relative">
                                                        <img :src="preview" class="w-full h-16 object-cover rounded">
                                                        <button type="button" 
                                                                @click.stop="removeImage(index)"
                                                                class="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hover:bg-red-600">
                                                            <svg class="w-2 h-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </template>
                                            </div>
                                            <p class="text-sm text-primary-600" x-text="`${imagesPreviews.length} imagem(ns) selecionada(s)`"></p>
                                            <template x-if="imagesPreviews.length > 6">
                                                <p class="text-xs text-gray-500" x-text="`+${imagesPreviews.length - 6} imagens adicionais`"></p>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <input x-ref="imagesInput" 
                                   name="site_images" 
                                   type="file" 
                                   accept="image/*" 
                                   multiple 
                                   @change="handleImagesChange($event)"
                                   class="hidden">
                        </div>
                    </div>
                    
                    <!-- Color Palette Display -->
                    <div x-show="extractedColors.length > 0" 
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 transform scale-95"
                                                 x-transition:enter-end="opacity-100 transform scale-100"
                         class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-3 flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"></path>
                            </svg>
                            Paleta de Cores Extra√≠da
                        </h3>
                        <div class="flex space-x-3">
                            <template x-for="(color, index) in extractedColors" :key="index">
                                <div class="text-center">
                                    <div class="w-12 h-12 rounded-lg shadow-sm border-2 border-white" 
                                         :style="`background-color: ${color}`"
                                         :title="color"></div>
                                    <p class="text-xs text-gray-600 mt-1" x-text="['Prim√°ria', 'Secund√°ria', 'Destaque'][index] || 'Extra'"></p>
                                    <p class="text-xs font-mono text-gray-500" x-text="color"></p>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Briefing -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Briefing do Cliente *
                        </label>
                        <textarea name="main_content_brief" 
                                  x-model="form.brief"
                                  rows="6" 
                                  required
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors resize-none"
                                  placeholder="Descreva detalhadamente o projeto: objetivo da p√°gina, p√∫blico-alvo, servi√ßos/produtos, diferenciais, estilo desejado, etc."></textarea>
                        <div class="flex justify-between items-center mt-2">
                            <p class="text-sm text-gray-500">Seja espec√≠fico: quanto mais detalhes, melhor ser√° o resultado da IA.</p>
                            <p class="text-xs text-gray-400" x-text="`${form.brief.length} caracteres`"></p>
                        </div>
                    </div>
                    
                    <!-- Submit Button -->
                    <div class="flex justify-end pt-4 border-t">
                        <button type="submit" 
                                :disabled="isSubmitting"
                                class="bg-primary-600 hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-8 py-3 rounded-lg font-medium flex items-center space-x-2 transition-all transform hover:scale-105">
                            <svg x-show="isSubmitting" class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <svg x-show="!isSubmitting" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                            <span x-text="isSubmitting ? 'Criando Landing Page...' : 'Criar Landing Page'"></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Recent Requests -->
            <div class="bg-white rounded-lg shadow-sm border">
                <div class="bg-gray-50 px-6 py-4 border-b rounded-t-lg">
                    <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        Solicita√ß√µes Recentes
                    </h3>
                </div>
                <div class="p-6">
                    {% if requests %}
                        <div class="space-y-4">
                            {% for req in requests %}
                            <div class="border-l-4 border-primary-400 bg-primary-50 p-4 rounded-r-lg hover:bg-primary-100 transition-colors">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <a href="{{ url_for('view_request', request_id=req.request_id) }}" 
                                           class="text-primary-800 hover:text-primary-900 font-medium text-sm">
                                            {{ req.page_title }}
                                        </a>
                                        <p class="text-primary-600 text-xs mt-1">{{ req.company_name }}</p>
                                        <p class="text-primary-500 text-xs mt-2">{{ req.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
                                    </div>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                        {{ 'bg-green-100 text-green-800' if req.status == 'completed' 
                                           else 'bg-blue-100 text-blue-800' if req.status == 'uploads_completed' 
                                           else 'bg-yellow-100 text-yellow-800' }}">
                                        {{ 'Conclu√≠do' if req.status == 'completed' 
                                           else 'Em Progresso' if req.status == 'uploads_completed' 
                                           else 'Pendente' }}
                                    </span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        
                        {% if requests|length >= 5 %}
                        <div class="mt-4 pt-4 border-t">
                            <a href="{{ url_for('api_requests') }}" 
                               class="text-primary-600 hover:text-primary-700 text-sm font-medium flex items-center">
                                Ver todas as solicita√ß√µes
                                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </a>
                        </div>
                        {% endif %}
                    {% else %}
                        <div class="text-center py-8">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                            </svg>
                            <p class="text-gray-500 text-sm mt-2">Nenhuma solicita√ß√£o encontrada</p>
                            <p class="text-gray-400 text-xs mt-1">Crie sua primeira landing page!</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- System Status -->
            <div class="bg-white rounded-lg shadow-sm border">
                <div class="bg-gray-50 px-6 py-4 border-b rounded-t-lg">
                    <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        Status do Sistema
                    </h3>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 gap-4">
                        <!-- MySQL Status -->
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" clip-rule="evenodd"></path>
                                </svg>
                                <div class="ml-3">
                                    <p class="text-sm font-medium text-gray-900">MySQL</p>
                                    <p class="text-xs text-gray-500">Banco de dados</p>
                                </div>
                            </div>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800" 
                                  data-status="mysql">
                                Conectado
                            </span>
                        </div>
                        
                        <!-- Color Extraction -->
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"></path>
                                </svg>
                                <div class="ml-3">
                                    <p class="text-sm font-medium text-gray-900">Extra√ß√£o de Cores</p>
                                    <p class="text-xs text-gray-500">Regra 60-30-10</p>
                                </div>
                            </div>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                Ativo
                            </span>
                        </div>
                        
                        <!-- Claude API -->
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                </svg>
                                <div class="ml-3">
                                    <p class="text-sm font-medium text-gray-900">Claude API</p>
                                    <p class="text-xs text-gray-500">Intelig√™ncia Artificial</p>
                                </div>
                            </div>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                                {{ 'bg-green-100 text-green-800' if claude_status == 'connected' 
                                   else 'bg-yellow-100 text-yellow-800' if claude_status == 'not_configured' 
                                   else 'bg-red-100 text-red-800' }}">
                                {{ 'Conectado' if claude_status == 'connected' 
                                   else 'N√£o configurado' if claude_status == 'not_configured' 
                                   else 'Erro' }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tips & Guidelines -->
            <div class="bg-white rounded-lg shadow-sm border">
                <div class="bg-gradient-to-r from-yellow-50 to-orange-50 px-6 py-4 border-b rounded-t-lg">
                    <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                        Dicas & Orienta√ß√µes
                    </h3>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                    <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6 6h.01M6 20h36a2 2 0 012 2v16a2 2 0 01-2 2H6a2 2 0 01-2-2V22a2 2 0 012-2z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-sm font-medium text-gray-900">Logo de Qualidade</h4>
                                <p class="text-sm text-gray-600">Use imagem com boa resolu√ß√£o para melhor extra√ß√£o de cores e resultado visual.</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                    <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-sm font-medium text-gray-900">Paleta de Cores</h4>
                                <p class="text-sm text-gray-600">Seguimos a regra 60% (prim√°ria), 30% (secund√°ria), 10% (destaque) para harmonia visual.</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                    <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6 6h.01M6 20h36a2 2 0 012 2v16a2 2 0 01-2 2H6a2 2 0 01-2-2V22a2 2 0 012-2z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-sm font-medium text-gray-900">Imagens Relevantes</h4>
                                <p class="text-sm text-gray-600">Selecione imagens que representem bem seu neg√≥cio e p√∫blico-alvo.</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center">
                                    <svg class="w-4 h-4 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-sm font-medium text-gray-900">Briefing Detalhado</h4>
                                <p class="text-sm text-gray-600">Seja espec√≠fico sobre objetivos, p√∫blico-alvo e diferenciais para melhor resultado da IA.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 pt-4 border-t border-gray-200">
                        <div class="bg-blue-50 rounded-lg p-4">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <h4 class="text-sm font-medium text-blue-900">Dica Pro</h4>
                            </div>
                            <p class="text-sm text-blue-800 mt-1">
                                Use <kbd class="px-2 py-1 bg-blue-200 rounded text-xs">Ctrl+N</kbd> para abrir rapidamente o modal de cria√ß√£o!
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Stats -->
            <div class="bg-gradient-to-br from-primary-600 to-primary-700 rounded-lg shadow-sm text-white p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold">Estat√≠sticas</h3>
                        <p class="text-primary-100 text-sm">Resumo do sistema</p>
                    </div>
                    <svg class="w-8 h-8 text-primary-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                </div>
                <div class="grid grid-cols-2 gap-4 mt-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold">{{ requests|length if requests else 0 }}</div>
                        <div class="text-primary-100 text-xs">Landing Pages</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold">{{ (requests|selectattr('status', 'equalto', 'completed')|list|length) if requests else 0 }}</div>
                        <div class="text-primary-100 text-xs">Conclu√≠das</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function indexPage() {
    return {
        // Form data
        form: {
            pageTitle: '',
            companyName: '',
            brief: ''
        },
        
        // File handling
        logoPreview: null,
        imagesPreviews: [],
        extractedColors: [],
        
        // States
        isSubmitting: false,
        
        // Methods
        init() {
            console.log('üìÑ Index page initialized');
            
            // Listen for create modal events
            this.$watch('$store.app.showCreateModal', (value) => {
                if (value) {
                    this.resetForm();
                }
            });
        },
        
        // Form handling
        handleSubmit(event) {
            if (!this.validateForm()) {
                event.preventDefault();
                return false;
            }
            
            this.isSubmitting = true;
            this.$dispatch('show-loading', 'Processando uploads e criando solicita√ß√£o...');
            
            // Form will submit normally
            return true;
        },
        
        validateForm() {
            const { pageTitle, companyName, brief } = this.form;
            
            if (!pageTitle || pageTitle.trim().length < 3) {
                this.$dispatch('add-notification', {
                    type: 'warning',
                    message: 'T√≠tulo da p√°gina deve ter pelo menos 3 caracteres.'
                });
                return false;
            }
            
            if (!companyName || companyName.trim().length < 2) {
                this.$dispatch('add-notification', {
                    type: 'warning',
                    message: 'Nome da empresa deve ter pelo menos 2 caracteres.'
                });
                return false;
            }
            
            if (!brief || brief.trim().length < 50) {
                this.$dispatch('add-notification', {
                    type: 'warning',
                    message: 'Briefing deve ter pelo menos 50 caracteres para um bom resultado.'
                });
                return false;
            }
            
            return true;
        },
        
        resetForm() {
            this.form = {
                pageTitle: '',
                companyName: '',
                brief: ''
            };
            this.logoPreview = null;
            this.imagesPreviews = [];
            this.extractedColors = [];
            this.isSubmitting = false;
        },
        
        // Logo handling
        handleLogoChange(event) {
            const file = event.target.files[0];
            if (file) {
                this.processLogo(file);
            }
        },
        
        handleLogoDrop(event) {
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    this.processLogo(file);
                    // Update the file input
                    this.$refs.logoInput.files = files;
                } else {
                    this.$dispatch('add-notification', {
                        type: 'warning',
                                                message: 'Por favor, selecione apenas arquivos de imagem.'
                    });
                }
            }
        },
        
        processLogo(file) {
            // Validate file size (5MB)
            if (file.size > 5 * 1024 * 1024) {
                this.$dispatch('add-notification', {
                    type: 'warning',
                    message: 'Logo muito grande. M√°ximo 5MB permitido.'
                });
                return;
            }
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                this.$dispatch('add-notification', {
                    type: 'warning',
                    message: 'Formato inv√°lido. Use JPG, PNG ou SVG.'
                });
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                this.logoPreview = e.target.result;
                this.extractColorsFromLogo(file);
            };
            reader.readAsDataURL(file);
        },
        
        removeLogo() {
            this.logoPreview = null;
            this.extractedColors = [];
            this.$refs.logoInput.value = '';
        },
        
        // Images handling
        handleImagesChange(event) {
            const files = Array.from(event.target.files);
            this.processImages(files);
        },
        
        handleImagesDrop(event) {
            const files = Array.from(event.dataTransfer.files);
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length !== files.length) {
                this.$dispatch('add-notification', {
                    type: 'warning',
                    message: 'Alguns arquivos n√£o s√£o imagens e foram ignorados.'
                });
            }
            
            if (imageFiles.length > 0) {
                this.processImages(imageFiles);
                // Update the file input
                const dt = new DataTransfer();
                imageFiles.forEach(file => dt.items.add(file));
                this.$refs.imagesInput.files = dt.files;
            }
        },
        
        processImages(files) {
            this.imagesPreviews = [];
            
            files.forEach((file, index) => {
                // Validate file size (10MB)
                if (file.size > 10 * 1024 * 1024) {
                    this.$dispatch('add-notification', {
                        type: 'warning',
                        message: `Imagem ${index + 1} muito grande. M√°ximo 10MB por imagem.`
                    });
                    return;
                }
                
                // Validate file type
                if (!file.type.startsWith('image/')) {
                    this.$dispatch('add-notification', {
                        type: 'warning',
                        message: `Arquivo ${index + 1} n√£o √© uma imagem v√°lida.`
                    });
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    this.imagesPreviews.push(e.target.result);
                };
                reader.readAsDataURL(file);
            });
            
            if (files.length > 0) {
                this.$dispatch('add-notification', {
                    type: 'success',
                    message: `${files.length} imagem(ns) carregada(s) com sucesso.`
                });
            }
        },
        
        removeImage(index) {
            this.imagesPreviews.splice(index, 1);
            
            // Update file input
            const dt = new DataTransfer();
            const currentFiles = Array.from(this.$refs.imagesInput.files);
            currentFiles.forEach((file, i) => {
                if (i !== index) {
                    dt.items.add(file);
                }
            });
            this.$refs.imagesInput.files = dt.files;
        },
        
        // Color extraction (placeholder - would integrate with backend)
        extractColorsFromLogo(file) {
            // Show loading state
            this.extractedColors = [];
            
            // Simulate API call for color extraction
            setTimeout(() => {
                // Placeholder colors - in real implementation, this would call the backend
                this.extractedColors = ['#667eea', '#764ba2', '#f093fb'];
                
                this.$dispatch('add-notification', {
                    type: 'success',
                    message: 'Cores extra√≠das da logo com sucesso!'
                });
            }, 1500);
        },
        
        // Utility methods
        formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    }
}

// Auto-focus management
document.addEventListener('alpine:init', () => {
    Alpine.directive('auto-focus', (el, { expression }, { evaluate, cleanup }) => {
        if (evaluate(expression)) {
            setTimeout(() => el.focus(), 100);
        }
    });
});

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
    // Ctrl/Cmd + Enter = Submit form if focused
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        const activeForm = document.querySelector('form:focus-within');
        if (activeForm) {
            e.preventDefault();
            const submitBtn = activeForm.querySelector('button[type="submit"]');
            if (submitBtn && !submitBtn.disabled) {
                submitBtn.click();
            }
        }
    }
});

// Drag and drop visual feedback
document.addEventListener('DOMContentLoaded', () => {
    const dropZones = document.querySelectorAll('[data-drop-zone]');
    
    dropZones.forEach(zone => {
        zone.addEventListener('dragenter', (e) => {
            e.preventDefault();
            zone.classList.add('border-primary-400', 'bg-primary-50');
        });
        
        zone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            if (!zone.contains(e.relatedTarget)) {
                zone.classList.remove('border-primary-400', 'bg-primary-50');
            }
        });
        
        zone.addEventListener('dragover', (e) => {
            e.preventDefault();
        });
        
        zone.addEventListener('drop', (e) => {
            e.preventDefault();
            zone.classList.remove('border-primary-400', 'bg-primary-50');
        });
    });
});

// Performance monitoring for file uploads
function monitorFileUpload() {
    const fileInputs = document.querySelectorAll('input[type="file"]');
    
    fileInputs.forEach(input => {
        input.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            const totalSize = files.reduce((sum, file) => sum + file.size, 0);
            
            console.log(`üìÅ ${files.length} arquivo(s) selecionado(s)`);
            console.log(`üìä Tamanho total: ${(totalSize / 1024 / 1024).toFixed(2)} MB`);
            
            // Warn about large uploads
            if (totalSize > 50 * 1024 * 1024) { // 50MB
                console.warn('‚ö†Ô∏è Upload grande detectado. Pode demorar mais para processar.');
            }
        });
    });
}

// Initialize monitoring
document.addEventListener('DOMContentLoaded', monitorFileUpload);

// Auto-save form data to localStorage (optional feature)
function initAutoSave() {
    const form = document.querySelector('form[action="/create-request"]');
    if (!form) return;
    
    const STORAGE_KEY = 'landing_page_form_draft';
    
    // Load saved data
    const savedData = localStorage.getItem(STORAGE_KEY);
    if (savedData) {
        try {
            const data = JSON.parse(savedData);
            Object.keys(data).forEach(key => {
                const input = form.querySelector(`[name="${key}"]`);
                if (input && input.type !== 'file') {
                    input.value = data[key];
                    // Trigger Alpine.js reactivity
                    input.dispatchEvent(new Event('input', { bubbles: true }));
                }
            });
        } catch (e) {
            console.warn('Erro ao carregar rascunho salvo:', e);
        }
    }
    
    // Save data on input
    const textInputs = form.querySelectorAll('input[type="text"], textarea');
    textInputs.forEach(input => {
        input.addEventListener('input', debounce(() => {
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                if (typeof value === 'string') {
                    data[key] = value;
                }
            }
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }, 1000));
    });
    
    // Clear on successful submit
    form.addEventListener('submit', () => {
        localStorage.removeItem(STORAGE_KEY);
    });
}

// Debounce utility
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Initialize auto-save
document.addEventListener('DOMContentLoaded', initAutoSave);

// Console welcome message
console.log('%cüöÄ Landing Page Generator - Index', 'color: #667eea; font-size: 16px; font-weight: bold;');
console.log('%cüìÑ P√°gina inicial carregada com sucesso!', 'color: #10b981; font-weight: bold;');
console.log('%c‚å®Ô∏è Atalhos dispon√≠veis:', 'color: #6c757d; font-weight: bold;');
console.log('%c  ‚Ä¢ Ctrl/Cmd + N: Nova Landing Page', 'color: #6c757d;');
console.log('%c  ‚Ä¢ Ctrl/Cmd + Enter: Enviar formul√°rio (quando focado)', 'color: #6c757d;');
console.log('%c  ‚Ä¢ Arrastar e soltar: Upload de arquivos', 'color: #6c757d;');
</script>
{% endblock %}
